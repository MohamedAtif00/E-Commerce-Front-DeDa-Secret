<div *ngFor="let node of treeData" class="ml-4">
  <div
    class="tree-node flex items-center"
    draggable="true"
    (dragstart)="onDragStart($event, node)"
    (dragover)="onDragOver($event)"
    (drop)="onDrop($event, node)"
  >
    <!-- Editable node section -->
    <div *ngIf="node.editing; else displayNode">
      <input
        type="text"
        [(ngModel)]="node.name"
        class="border border-gray-300 p-1 rounded"
      />
      <button class="ml-2 text-blue-500" (click)="saveNode(node)">Save</button>
    </div>

    <!-- Display node with drag handle -->
    <ng-template #displayNode>
      <span class="cursor-move">{{ node.name }}</span>
      <button class="ml-2 text-green-500" (click)="toggleAddCategory(node)">
        Add
      </button>
      <button class="ml-2 text-blue-500" (click)="editNode(node)">Edit</button>
    </ng-template>
  </div>

  <!-- Input field to add new category -->
  <div *ngIf="node.isAddingChild" class="ml-6">
    <input
      type="text"
      [(ngModel)]="node.newCategoryName"
      placeholder="New Category Name"
      class="border border-gray-300 p-1 rounded"
    />
    <button class="ml-2 text-green-500" (click)="addNewCategory(node)">
      Add Category
    </button>
  </div>

  <!-- Recursively render children -->
  <div *ngIf="node.children?.length > 0" class="ml-4">
    <ng-container *ngFor="let child of node.children">
      <div
        class="tree-node flex items-center"
        draggable="true"
        (dragstart)="onDragStart($event, child)"
        (dragover)="onDragOver($event)"
        (drop)="onDrop($event, child)"
      >
        <div *ngIf="child.editing; else displayChildNode">
          <input
            type="text"
            [(ngModel)]="child.name"
            class="border border-gray-300 p-1 rounded"
          />
          <button class="ml-2 text-blue-500" (click)="saveNode(child)">
            Save
          </button>
        </div>

        <ng-template #displayChildNode>
          <span class="cursor-move">{{ child.name }}</span>
          <button
            class="ml-2 text-green-500"
            (click)="toggleAddCategory(child)"
          >
            Add
          </button>
          <button class="ml-2 text-blue-500" (click)="editNode(child)">
            Edit
          </button>
        </ng-template>
      </div>

      <!-- Recursively render grandchildren -->
      <div *ngIf="child.children?.length > 0" class="ml-4">
        <ng-container *ngFor="let grandChild of child.children">
          <!-- Continue rendering the nested children -->
        </ng-container>
      </div>
    </ng-container>
  </div>
</div>
